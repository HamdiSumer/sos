-- Time difference for each request

SELECT requesttime, currentstatus, Victim_RequesterID_id, deliverytime,
           CASE
               WHEN deliverytime IS NULL THEN NULL
               ELSE deliverytime - requesttime
           END AS Response_Time
    FROM myapp_request;

-- Average response time overall
SELECT AVG(a.Response_Time) AS mean_response_time
FROM (SELECT requesttime, currentstatus, Victim_RequesterID_id, deliverytime,
           CASE
               WHEN deliverytime IS NULL THEN NULL
               ELSE deliverytime - requesttime
           END AS Response_Time
    FROM myapp_request) a;

-- Average response time grouped by district

SELECT ad.DistrictName, ad.Coordination, ad.Population, AVG(ad.Response_Time) AS mean_response_time
FROM
(
SELECT *,  CASE
               WHEN deliverytime IS NULL THEN NULL
               ELSE deliverytime - requesttime
           END AS Response_Time
FROM myapp_request mr
LEFT JOIN
myapp_victim mv, myapp_district md
         WHERE mr.Victim_RequesterID_id = mv.id AND
         mv.District_DistrictID_id = md.id) ad
GROUP BY ad.DistrictName


